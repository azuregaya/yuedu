<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh">
<head>
<title>页面标题</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
<meta http-equiv="content-style-type" content="text/css"/>
<meta http-equiv="content-script-type" content="text/javascript"/>
<meta http-equiv="x-ua-compatible" content="ie=emulateie7"/>
<meta name="author" content="netease"/>
<meta name="version" content="1.0"/>
<meta name="keywords" content=""/>
<meta name="description" content=""/>
<link type="text/css" rel="stylesheet" href="css/header.css"/>
<link type="text/css" rel="stylesheet" href="css/yuan.css"/>
<link href="css/inner.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://yuedu.bst2.126.net/js/jquery-1.6.1.min.js?0010"></script>
</head>
<body id="page-163-com" >
<noscript>请使用支持脚本的浏览器！</noscript>
<div class="g-doc">
    <div class="g-hdw">
		<div class="g-hd g-hd-t">
			<h1 class="m-logo"><a href="#">网易阅读</a></h1>
			<div class="m-nav">
				<ul>
					<li class="nw j-crt"><a href="#" hidefocus="hidefocus" onclick="_gaq.push(['_trackEvent', 'yuedu', 'click', 'home']);">首页</a></li>
					<li class="ww"><a href="#" hidefocus="hidefocus" onclick="_gaq.push(['_trackEvent', 'yuedu', 'click', 'content']);">内容中心</a></li>
					<li class="ww"><a href="#" hidefocus="hidefocus" onclick="_gaq.push(['_trackEvent', 'yuedu', 'click', 'content']);">我的订阅<b></b></a></li>
					<li class="nw"><a href="#" hidefocus="hidefocus" onclick="_gaq.push(['_trackEvent', 'yuedu', 'click', 'client']);">下载</a></li>
				</ul>
			</div>
			
			<div class="m-ulink" style="display:none;"><a href="#" onclick="_gaq.push(['_trackEvent', 'yuedu', 'click', 'login']);">登录</a><span class="sep">|</span><a href="#" onclick="_gaq.push(['_trackEvent', 'yuedu', 'mycenter', 'manage_subs']);">注册</a></div>
			
			<div id="J_tb" class="m-ulink" state="1">
				<ul class="wrap">
					<li class="items items-1" >
						<a class="name-1 ">一路向南，哈哈哈</a>
						<div class="openbox f-dn">
							<h4><a class="name-3">一路向南，哈哈哈</a></h4>
							<p class="name-2">Hi,XXXXXXXXXX,</p><p>从现在开始，随时随地阅读!</p>
							<a class="active" href="#"></a>
							
						</div>
					</li>
					<li class="items items-2" >
						<a class="arrow"></a>
						<ul class="options f-dn">
							<li><a href="#">反馈意见</a></li>
							<li><a href="#">退出</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div class="m-sch"><form action="#"><input type="text" id="topsearch" /><button type="submit">&nbsp;</button></form></div>
		</div>
	</div>

    <div class="g-bd">
        <div class="g-bdc3 g-bdc7">
			<div class="g-bc">
				<div class="m-topbar m-topbar-1">
					<h2>发现discovery</h2>
					<div id="J_Hint" class="hint" style="display:none;"></div>
					<div class="op">
						<a id="J_Reload" class="btn4" href="javascript:void(0);"></a>
						<a id="J_Browse" class="btn5"><span class="up"></span><span class="down"></span></a>
						<a id="J_Comments" class="btn1" href="javascript:void(0);">发表评论</a>
						<a id="J_Subscribe" class="o1" href="javascript:void(0);">订阅该源</a>
					</div>
				</div>
			</div>
            <div id="J_LSec" class="g-sd3 g-scrollsec">
                <div class="m-dy">
                    <div class="m-dyimg">
                        <div class="w-img"><img src="http://imgrc.ph.126.net/AJtI1hv0YsVhxJ9t3_4LWA==/4222687600613270630.jpg" alt="" /></div>
                        <div class="txt">
                            <div class="w-star"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span><span class="no">&nbsp;</span></div>
                            <p><span id="J_DingNum">12313</span>人订阅&nbsp;&nbsp;每周更新5篇</p>
                        </div>
                    </div>
                </div>
				
				<div class="m-sdbox">
                    <h3>详细评分</h3>
                    <div class="sdbox">
                        <div class="m-stars" id="allstars">
                            <div class="itm itm-5"><span class="sn">5星</span><span class="sc">&nbsp;</span><span class="sm">7</span></div>
                            <div class="itm itm-4"><span class="sn">4星</span><span class="sc">&nbsp;</span><span class="sm">5</span></div>
                            <div class="itm itm-3"><span class="sn">3星</span><span class="sc">&nbsp;</span><span class="sm">1</span></div>
                            <div class="itm itm-2"><span class="sn">2星</span><span class="sc">&nbsp;</span><span class="sm">1</span></div>
                            <div class="itm itm-1"><span class="sn">1星</span><span class="sc">&nbsp;</span><span class="sm">3</span></div>
                        </div>
                    </div>
                </div>
				<div class="m-sdbox">
                    <h3>内容简介</h3>
                    <div class="sdbox">
                    	<div class="my-para">
                            <p>网易娱乐是最全面最专业的娱乐资讯平台，提供娱乐八卦新闻和专题报道，集明星、女星、电影、电视、音乐、视频等娱乐资讯。</p>
                        </div>
                    </div>
                </div>
                
                <div class="m-sdbox">
                    <h3>用户评论</h3>
                    <div class="m-comts sdbox">
                    	<ul id="J_SubCmtList">
							<li>
								<div class="title"><h4>cai45212007</h4><span> 昨天 17:39</span></div>
								<span class="w-star w-star1">
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span class="no">&nbsp;</span>
								</span>
								<p>
								真是那啥太好了呀~这个源8错滴，更新快，信息量大是个好内容！
								</p>
							</li>
							<li>
								<div class="title"><h4>cai45212007</h4><span> 昨天 17:39</span></div>
								<span class="w-star w-star1">
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span class="no">&nbsp;</span>
								</span>
								<p>
								真是那啥太好了呀~这个源8错滴，更新快，信息量大是个好内容！
								</p>
							</li>
							<li>
								<div class="title"><h4>cai45212007</h4><span> 昨天 17:39</span></div>
								<span class="w-star w-star1">
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span class="no">&nbsp;</span>
								</span>
								<p>
								真是那啥太好了呀~这个源8错滴，更新快，信息量大是个好内容！
								</p>
							</li>
							<li>
								<div class="title"><h4>cai45212007</h4><span> 昨天 17:39</span></div>
								<span class="w-star w-star1">
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span class="no">&nbsp;</span>
								</span>
								<p>
								真是那啥太好了呀~这个源8错滴，更新快，信息量大是个好内容！
								</p>
							</li>
							<li>
								<div class="title"><h4>cai45212007</h4><span> 昨天 17:39</span></div>
								<span class="w-star w-star1">
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span>&nbsp;</span>
									<span class="no">&nbsp;</span>
								</span>
								<p>
								真是那啥太好了呀~这个源8错滴，更新快，信息量大是个好内容！
								</p>
							</li>
						</ul>
						<div class="m-page-1">
							<a href="" class="go go-p">上一页</a>
							<span class="dian">...</span>
							<span class="nums"><a href="javascript:loadSourceComments(2)" >2</a></span>
							<span class="nums"><a href="javascript:loadSourceComments(2)" class="j-crt">3</a></span>
							<span class="nums"><a href="javascript:loadSourceComments(2)" >4</a></span>
							<span class="dian">...</span>
							<a href="" class="go go-n">下一页</a>
						</div>
                    </div>
                
				</div>
            </div>
            <div id="J_RSec" class="g-mn g-scrollsec" style="position:relative;">
                <div id="J_entryCon" class="m-mainlist">
					<div id="J_addTenMore" class="m-tenmore" >
						<a href="javascript:void(0);">点击加载更多</a>
					</div>
					<div class="m-tenmore" >
						<a href="#">点击加载该源的最新文章</a>
					</div>
				</div>
            </div>
            <!--<div class="g-bdc3b"></div>-->
        </div>
    </div>
</div>

<div id="J_CmtTepl" style="display:none;" class="m-cmt">
	<h3>用户评论</h3>

	<div class="input">
		<div class="txtwrap"><textarea class="j-ta"></textarea></div>
	</div>
	<div class="botbar">
		<p>您的评分与评语将帮助我们去糙取精，为您推荐更加优质的内容</p>
		<a class="send disable">发表评论</a>
	</div>
		
	<div class="list" style="display:none;">
		<ul class="j-atcComtList">
			
		</ul>
		
	</div>
	
</div>

<div id="layer1" style="display:none;" class="m-layer m-layer-1">
    <div class="lytt yy"><h4>登录网易通行证</h4><a href="#" class="lyclose j-close">关闭</a></div>
    <div class="lyct">
        <div class="m-login">
            <form>
                <div class="row"><label>帐号：</label><div class="intwrap"><span class="ipt-wrap"><input class="ipt" type="text" /></span></div></div>
                <div class="row"><label>密码：</label><div class="intwrap"><span class="ipt-wrap"><input class="ipt" type="password" /></span></div></div>
                <div class="row row-1">
                    <input type="checkbox"/><label class="auto">两周内自动登录</label>
                    <a href="#">忘记密码？</a>
                </div>
                <div class="row row-1">
                    <button><span>登录</span></button>
                    <a class="wyt" href="#">注册网易通行证&gt;&gt;</a>
                </div>
            </form>
        </div>
    </div>
    <div class="lybt">
        <button class="j-close">我知道了</button>
    </div>
</div>
<div id="eptTip" style="display:none;" class="m-layer m-layer-3">
    <div class="lytt yy"><h4></h4><a href="#" class="lyclose j-close">关闭</a></div>
    <div class="lyct">
        <div class="m-actip">
            <h3>搜索内容不能为空</h3>
			<a href="#" class="btn j-close">我知道了</a>
        </div>
    </div>
    <div class="lybt">
        <button class="j-close">我知道了</button>
    </div>
</div>
<div id="sucTip" style="display:none;" class="m-layer m-layer-3">
    <div class="lytt yy"><h4></h4><a href="#" class="lyclose j-close">关闭</a></div>
    <div class="lyct">
        <div class="m-actip m-actip-1">
            <h3>排序保存成功！</h3>
			<a href="#" class="btn j-close">我知道了</a>
        </div>
    </div>
    <div class="lybt">
        <button class="j-close">我知道了</button>
    </div>
</div>
<div id="J_CmtTepl_pop" style="display:none;" class="m-popup m-popup-1">
	<div class="inner">
		<div class="topbar">
			<h5>评分</h5>
			<div id="J_Cmtstar_pop" class="w-star j-star"></div>
			<a class="j-close"></a>
		</div>
		<div>
			<textarea class="j-ta txt blur"></textarea>
		</div>
		<a class="send disable">发表评论</a>
	</div>
</div>
<div id="J_Forward" style="display:none;" class="m-popup m-popup-4">
	<div class="inner">
		<div class="topbar">
			<h5>顺便说几句</h5><a class="j-close"></a><span class="wrap"><span id="J_Words">0</span> / 140</span>
		</div>
		<form id="publishForm" action="/weibo.do" method="post">
		<div>
			<textarea id="J_ForTxt" name="message"></textarea>
		</div>
		<div class="botbar">
			<span class="zf">转发至：</span>
			<ul>
				<li class="sns1">
					<input name="site" value="1" type="checkbox" />
					<span class="mask"></span>
				</li>
				<li class="sns2">
					<input name="site" value="2" type="checkbox" />
					<span class="mask"></span>
				</li>
				<li class="sns3">
					<input name="site" value="3" type="checkbox" />
					<span class="mask"></span>
				</li>
				<li class="sns4">
					<input name="site" value="4" type="checkbox" />
					<span class="mask"></span>
				</li>
				<li class="sns5">
					<input name="site" value="5" type="checkbox" />
					<span class="mask"></span>
				</li>
				<li class="sns6">
					<input name="site" value="6" type="checkbox" />
					<span class="mask"></span>
				</li>
				<li class="sns7">
					<input name="site" value="7" type="checkbox" />
					<span class="mask"></span>
				</li>
			</ul>
			<a class="send">转发</a>
		</div>
		</form>
		<input type="hidden" id="J_GoWhere" />
		<div id="J_AtrLayer" style="display:none;" class="m-popup m-popup-7">
			<p>你的微博尚未得到授权，<a id="J_AtrGo">去授权&gt;&gt;</a></p>
			<a class="j-close-1"></a>
		</div>
	</div>
</div>
<input id="J_IFIE6" type="hidden" value="no"/>
<div class="m-mask f-dn"></div>
<script type="text/javascript" src="js/widgets.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	/* 小控件初始化 */
	YD.msgInput('#topsearch','s-fc4','搜索内容源');
	YD.starsAll('#allstars');
	
	/* DOM结构定义 */
	var container = $('#J_entryCon'),
		pop = $('#J_CmtTepl_pop'),//源评论弹出浮层
		mask = $('.m-mask'),
		cmtTepl = $('#J_CmtTepl'),//文章评论模板
		snsPanel = $('#J_Forward'),//转发弹出浮层
		snsTxt = $('#J_ForTxt'),//转发文本框
		wordType = $('#J_Words'),//转发已经输入字数框
		tenmore = $('#J_addTenMore'),//加载更多按钮
		subStars = $('#J_Cmtstar_pop'),//源评论星评级
		hintBox = $('#J_Hint'),//提示框
		starNum = $('#allstars .sm'),//5个星级条
		leftSec = $('#J_LSec'),//左侧滚动区域
		rightSec = $('#J_RSec');//右侧滚动区域;
		
	var itemArr ={},openItem,entryArr=[],pages=0;
	
	
	$('#J_Reload').click(function(){//刷新页面按钮
		location.reload();
	});
	
	$('.j-close').click(function(){//弹出框关闭按钮
		$(this).parents('.m-popup').hide();
	});
	
	var popHint = function(str){
		hintBox.empty().text(str).clearQueue().fadeIn(300).delay(2500).fadeOut(300);
	};
	
	var cmtStateCheck = function(callback){
		$.get('data/json7.js',['id'],function(data){
			if(data.ResultCode === -999){//没有登录
				YD.openLayer('#layer1');
			}else if(data.ResultCode === -998){//没有激活阅读
				//TODO 激活阅读弹窗
			}else if(data.ResultCode === -1){//出错了
				popHint('发生未知错位'); //ERROR TIP
			}else if(data.ResultCode === 0){
				if(data.Mark === 'yes'){//读取星级，不加事件
					subStars.empty();
					var eles1 = '';
					for(var i=0; i<(data.Stars*1); i++){
						eles1 += '<a href="javascript:void(0)"><span>&nbsp;</span></a>';
					}
					for(var j=0; j<(5-(data.Stars*1));j++){
						eles1 += '<a href="javascript:void(0)"><span class="no">&nbsp;</span></a>';
					}
					subStars.append(eles1);
					starClick('done');
				}else if(data.Mark === 'no'){//没有评分，添加评分
					subStars.empty().unbind();
					var eles2 = '';
					for(var k=0; k<5; k++){
						eles2 +='<a href="javascript:void(0)"><span>&nbsp;</span></a>';
					}
					subStars.append(eles2);
					YD.stars('#J_Cmtstar_pop');
					starClick('doing');
				}
				
				callback && callback();
			}
		},['json']);
	};
	
	var starClick = function(state){//发送星评分
		subStars.click(function(){
			if(state === 'done'){
				popHint('您已经评分，不能再评'); //ERROR TIP
			}else if(state === 'doing'){
				var stared = 5;
				$('#J_Cmtstar_pop span').each(function(){
					if($(this).hasClass('no')){
						stared --;
					}
				});
				$.get('data/json8.js',[stared],function(data){
					if(data.ResultCode === -999){//没有登录
						YD.openLayer('#layer1');
					}else if(data.ResultCode === 0){
						if(data.ResultState === 'success'){//暂定2种情况--成功/已经评过
							popHint('评分成功'); //ERROR TIP
							//console.log('this stared is',stared);
							switch(stared){
								case 5:
								starNum[0].innerHTML = starNum[0].innerHTML*1+1;
								break;
								
								case 4:
								starNum[1].innerHTML = starNum[1].innerHTML*1+1;
								break;
								
								case 3:
								starNum[2].innerHTML = starNum[2].innerHTML*1+1;
								break;
								
								case 2:
								starNum[3].innerHTML = starNum[3].innerHTML*1+1;
								break;
								
								case 1:
								starNum[4].innerHTML = starNum[4].innerHTML*1+1;
								break;
								
								default:
								break;
							}
							
							YD.starsAll('#allstars');
						}else if(data.ResultState === 'failure'){
							popHint('您已经评分，不能再评'); //ERROR TIP
						}
					}
				},"json");
			}
		});
		
	};
	
	var subsComt = function(){//源评论事件
		formatComt('pop');
		$('#J_ComTxt_pop').focus(function(){
			$(this).removeClass('blur').addClass('focus');
		}).blur(function(){
			$(this).removeClass('focus').addClass('blur');
		}).keyup(function(){//检测字数,控制500以内
			if($.trim($(this).val()).length > 500){
				var newVal = $.trim($(this).val()).substring(0,500);
				$(this).val(newVal);
			}
		});
		
		$('#J_Comments').click(function(){
			var toff = $(this).offset().top + 24, loff = $(this).offset().left - 410;
			cmtStateCheck(function(){
				pop.css({'top':toff,'left':loff}).show();
			});
		});
		
	}
	
	var formatComt = function(_num){//添加评论基本事件
		var comtBox = $('#J_CmtTepl_'+_num),
			txta = $('.j-ta',comtBox),
			sendBtn = $('.send',comtBox);
			
		txta.attr('id',('J_ComTxt_'+_num));
		YD.msgInput(('#J_ComTxt_'+_num),'s-fc4','说说我的看法');
		
		$('#J_ComTxt_'+_num).keyup(function(){//检测字数为空时按钮样式
			//console.log($(this).val().length);
			if($.trim($(this).val()).length == 0){
				sendBtn.removeClass('enable').addClass('disable');
			}else{
				sendBtn.removeClass('disable').addClass('enable');
			}
		});
		
		sendBtn.click(function(){
			if($(this).hasClass('enable')){
			
			var comtTxt = txta.val();
			
			$.get('data/json6.js',['articleID',comtTxt],function(data){
				var newComt;
				if(data.state === 'success'){
					if(_num === "pop"){//内容为源评论
						newComt = '<li><div class="title"><h4>' + data.username + '</h4><span>' + data.posttime + '</span></div>';
						newComt += '<span class="w-star w-star1">';
						for(var i=0; i<(data.stars*1); i++){
							newComt += '<span>&nbsp;</span>';
						}
						for(var j=0; j<(5-(data.stars*1));j++){
							newComt += '<span class="no">&nbsp;</span>';
						}
						newComt +='</span><p>' + data.text +'</p></li>'
						$('#J_SubCmtList').prepend(newComt);
						pop.hide();
						//console.log(newComt);
					}else{//内容为文章评论
						newComt = '<li><div class="who">';
						newComt += '<strong>'+ data.username + '</strong>';
						newComt += '<span class="time">' + data.posttime + '</span></div>';
						newComt += '<p>' + data.text + '</p></li>';
						
						$('.j-atcComtList',comtBox).prepend(newComt);
						$('.j-atcComtList',comtBox).parent().show();
					}
					$('#J_ComTxt_'+_num).val('').blur();
				}
			},['json']);
			
			}
		});
	};
	
	
	var ifLogin = function(callback){//判断是否登录
		$.get('data/json2.js',['uername'],function(data){//传送参数为用户名信息
			var state = data.state;
			if(state === "logout"){
				YD.openLayer('#layer1');
				//mask.height(jQuery(document).height()).toggleClass('f-dn');
			}else if(state ==="login"){
				callback && callback();
			}
		},['json']);
	}
	
	var addMore = function(_boolean){//加载更多
		if(_boolean){
			tenmore.unbind().click(function(){
				loadBrief('data/json1.js');
			});
		}else{
			tenmore.unbind().addClass('m-tenmore-1').hide();
		}
	}
	
	var loadBrief = function(str){//加载十条缩略信息
		var url = str;
		$.ajax({
				url : url,
				data : [pages],
				dataType : "json",
				beforeSend : function(){
					hintBox.empty().text('正在加载文章缩略，请稍候').show();
				},
				success : function(_data){
					if(hintBox.css('display') !== 'none' && hintBox.text() === '正在加载文章缩略，请稍候'){
						hintBox.hide();
					}
					var data = _data[1];
					if(!data[0].entryID){
						popHint('文章加载失败！');
						tenmore.hide();
						return;
					}
					$.each(data,function(entryIndex){
						/* 创建缩略浏览部分DOM结构*/
						var entryHTML = '<div id="J_Entry' + data[entryIndex].entryID + '" class="m-entry m-entry-t" first="true" entryid="' + data[entryIndex].entryID + '" sourceid="' + data[entryIndex].sourceID +  '">';
						entryHTML += '<div class="header"><h2 class="headerh2 '+ data[entryIndex].read +'"><span></span>' + data[entryIndex].title + '</h2>' +'<span class="time">' + data[entryIndex].posttime + '</span></div>';
						entryHTML += '<div class="source"><p class="source">从  <a href="' + data[entryIndex].sourceURL + '" target="_blank">' + data[entryIndex].source + '</a></p></div>';
						entryHTML += '<div class="content">';
						entryHTML += '<div class="m-brief">';
						if(data[entryIndex].contentType === 'album' || data[entryIndex].contentType === 'video'){
							entryHTML += '<div class="m-bfimg"><img src="' + data[entryIndex].summaryImage.summaryImageURL + '"';
							if($('#J_IFIE6').val() === 'yes'){
								if(data[entryIndex].summaryImage.summaryImageWidth > 363){
									entryHTML += ' width="363"';
								}else if(data[entryIndex].summaryImage.summaryImageHeight > 250){
									entryHTML += ' height="250"';
								}
							}
							entryHTML += ' /></div>';
						}
						entryHTML += '<p>' + data[entryIndex].breif +'...<a class="switch switch-1">查看全文</a></p></div>';
						entryHTML += '<div class="m-detail hidden"></div>';
						entryHTML += '</div><div class="opt">';
						entryHTML += '<ul><li><a class="cmt" href="javascript:void(0);">评论</a></li>';
						if(data[entryIndex].favor === "unstar"){
							entryHTML += '<li class="favor favor-t"><a href="javascript:void(0);">收藏</a></li>';
						}else if(data[entryIndex].favor === "stared"){
							entryHTML += '<li class="favor favor-t favoron"><a href="javascript:void(0);">取消收藏</a></li>';
						}
						entryHTML += '<li><a class="forward forward-t" href="javascript:void(0);" data1="' + data[entryIndex].title +'" data2="' + data[entryIndex].sourceURL + '">转发至</a></li></ul>';
						entryHTML += '</div></div>';
						tenmore.before(entryHTML);
					});
					pages++;
					addBriefEvent();
					toggleStar();
					addMore(_data[0].more);
					shareSNS();
				}
		});
		
	};
	
	var toggleStar = function(){//添加取消收藏
		$('.favor-t a').click(function(){
			var btn = $(this),id=btn.parents('.m-entry').attr('entryid'),txt=btn.text();
			$.get('data/json5.js',[id,txt],function(data){//传送参数为该条目的ID号
				var state = data.state;
				if(state === 'unlogin') alert('请登录');
				if(state === 'stared'){
					btn.text('收藏').parent().removeClass('favoron');
				}else{
					btn.text('取消收藏').parent().addClass('favoron');
				}
			},['json']);
		});
		$('.favor').removeClass('favor-t');
	};
	
	var checkSNS = function(t,l){//检测开通的sns，目前按照排列对应顺序，可改成更准确的按照id
		var _title = t, _link = l;
		var si = $('.m-snsdata input'), snsArr = [],list = $('#J_Forward ul li');

		snsTxt.unbind().keyup(function(){//检测转发字数,控制140以内
			if($.trim($(this).val()).length > 140){
				var newVal = $.trim($(this).val()).substring(0,140);
				$(this).val(newVal);
			}
			var typed = $.trim($(this).val()).length;
			wordType.text(typed);
		});
		
		snsTxt.val(_title + '  ' + _link);
		snsTxt.trigger('keyup');
		
		$.ajax({//首次发送请求，查看授权
			type: 'GET',
			url: '/weibo.do?operation=bindings',
			crossDomain: false,
			dataType: 'json',
			data : [_title,_link],
			success: function(data) {
				try {
					list.each(function() {
						if (data.indexOf(Number(this.value)) != -1) {
							this.checked = true;
							$(this).removeClass('dis');
						}else{
							$(this).addClass('dis');
						}
					});
				} catch (e) {
					//alert(data);
				}
			},
			error: function() {
				popHint('error'); //ERRPR TIP
			}
		});
		
		list.unbind().click(function(e){
			var ctl = this,newCheckedState = this.checked;
			$('#J_GoWhere').val(this.value);
			if(newCheckedState){
				e.preventDefault();
				
				$.ajax({//再次验证授权状态
					type: 'GET',
					url: '/weibo.do?operation=checkAuthorization&site=' + this.value,
					crossDomain: false,
					dataType: 'json',
					data : [_title,_link],
					success: function(data) {
						try {
							if (data.isAuthorized) {
								ctl.checked = true;
							} else {
								$('#J_AtrLayer').show();//TODO 样式位置调整
							}
						} catch (e) {
							//alert(data);
						}
					},
					error: function() {
						popHint('error'); //ERRPR TIP
					}
				});
			}
		});
		
		$('#J_AtrGo').unbind().click(function(){
			$(this).parent().parent().hide();
			window.open('/weibo.do?operation=authorize&site=' + $('#J_GoWhere').val(), 'yueduWeiboAuthorize');
		});
		
		$('.j-close-1').unbind().click(function(){
			$(this).parent().parent().hide();
		});
		
		$('#J_Forward .send').unbind().click(function(){
			$.ajax({
				type: 'POST',
				url: '/weibo.do',
				data: $("#publishForm").serialize(),
				crossDomain: false,
				dataType: 'text',
				data : [_title,_link],
				success: function(data) {
					try {
						var success = '';
						var fail = '';
						var results = $.parseJSON(data);
						for (var i = 0; i < results.length; i++) {
							var r = results[i];
							if (r.successful) {
								success += r.siteName + ',';
							} else {
								fail += r.siteName + ',';
							}
						}
						//alert('success: ' + success + ' \nfail: ' + fail);
					} catch (e) {
						//alert(data);
					}
					$('#J_Forward').hide();
				},
				error: function() {
					popHint('error'); //ERRPR TIP
				}
			});
		});
	};
	
	var shareSNS = function(){//SNS转发
		$('.forward-t').click(function(){
			var toff = $(this).offset().top - 200,loff = $(this).offset().left - 473;
			//console.log($(this).offset().top,$(document).scrollTop());
			snsTxt.val('');
			wordType.text(0);
			snsPanel.css({'top':toff,'left':loff}).show();
			var title = $(this).attr('data1'),url = $(this).attr('data2');
			checkSNS(title,url);
		});
		$('.forward').removeClass('forward-t');
	};
	
	
	var addBriefEvent = function(){//缩略信息绑定事件
		$('.m-entry-t').click(function(e){
			var currentID = $(this).attr('entryid');
			if($(e.target).hasClass('headerh2') || $(e.target).hasClass('switch') || $(e.target).hasClass('cmt')){
				if(openItem){//控制只有一篇文章展开
					if(openItem.attr('entryid') !== $(this).attr('entryid') && $('.m-brief',openItem).hasClass('hidden')){
						$('.m-brief', openItem).toggleClass('hidden');
						$('.m-detail', openItem).toggleClass('hidden');
						//console.log('lastopen scrollTop is',itemArr[openItem.attr('entryid')]['scrollTop']);
						//console.log('lastopen offTop is',itemArr[openItem.attr('entryid')]['offTop']);
						//console.log('oooxxx2',($(this).position().top));
						rightSec.scrollTop($(this).position().top -144);
					}
					openItem = $(this);
				}else{
					openItem = $(this);
				}
				
				if($(this).attr('first') === 'true'){//文章首次加载
					//存储相关对象
					itemArr[currentID] = {};
					itemArr[currentID]['scrollTop'] = rightSec.scrollTop();
					//itemArr[currentID]['offTop'] = $(this).offset().top;
					//console.log('click item first scrollTop is',currentID,itemArr[currentID]['scrollTop']);
					//console.log('click item first offset is',currentID,itemArr[currentID]['offTop']);
					itemArr[currentID]['clickItem'] = $(this);
					itemArr[currentID]['breifBox'] = $('.m-brief',$(this));
					itemArr[currentID]['detailBox'] = $('.m-detail',$(this));
					itemArr[currentID]['header'] = $('.headerh2',$(this));
					
					
					//改变首次加载和未读状态
					$(this).attr('first','false');
					itemArr[currentID]['header'].removeClass('unread').addClass('read');
					
					//发送文章ajax请求
					$.ajax({
						url	: 'data/inner-8.html',
						dataType : 'html',
						beforeSend : function(){
							hintBox.empty().text('加载文章请稍候').show();
						},
						success : function(data){
							if(hintBox.css('dispaly') !== 'none' && hintBox.text() === '加载文章请稍候'){
								hintBox.hide();
							}
							itemArr[currentID]['detailBox'].append(data).toggleClass('hidden');
							itemArr[currentID]['breifBox'].toggleClass('hidden');
							cmtTepl.clone().appendTo(itemArr[currentID]['detailBox']).attr('id',('J_CmtTepl_'+currentID)).show();
							formatComt(currentID);
							
							/* 如果点击评论，移动到评论框focus */
							itemArr[currentID]['comt'] = $(('#J_ComTxt_' + currentID));
							if($(e.target).hasClass('cmt')){
								itemArr[currentID]['comt'].focus();
								rightSec.scrollTop(itemArr[currentID]['comt'].position().top-200);
							}
						}
					});
				}else{//文章非首次加载
					if(itemArr[currentID]['breifBox'].hasClass('hidden')){//文章展开，点击闭合状态
						if($(e.target).hasClass('cmt')){//文章展开状态点击评论
							itemArr[currentID]['comt'].focus();
							rightSec.scrollTop(itemArr[currentID]['comt'].position().top-200);
							return;
						}
						rightSec.scrollTop(itemArr[currentID]['scrollTop']);
					}else{//文章闭合，点击展开状态
						itemArr[currentID]['scrollTop'] = rightSec.scrollTop();
						//itemArr[currentID]['offTop'] = $(this).offset().top;
						//console.log('second set item scrollTop is',currentID,itemArr[currentID]['scrollTop']);
						//console.log('second set item offTop is',currentID,itemArr[currentID]['offTop']);
					}
					
					itemArr[currentID]['detailBox'].toggleClass('hidden');
					itemArr[currentID]['breifBox'].toggleClass('hidden');
					if($(e.target).hasClass('cmt')){//文章闭合状态点击评论
						itemArr[currentID]['comt'].focus();
						rightSec.scrollTop(itemArr[currentID]['comt'].position().top-200);
					}
				}
			}
		});
		
		//移入移出边框显示
		$('.m-entry-t').mouseenter(function(){
			$(this).addClass('m-entry-1');
		});
		
		$('.m-entry-t').mouseleave(function(){
			$(this).removeClass('m-entry-1');
		});
		
		
		entryArr = [];
		$('.m-entry').each(function(){
			entryArr.push($(this));
		});
		
		$('.m-entry').removeClass('m-entry-t');
		
		if(entryArr[0]){
			$('.headerh2',entryArr[0]).trigger('click');
		}
		
	};
	
	var entryBrowser = function(dir){//上一篇下一篇
			if(openItem){
				if(dir === 'down'){
					for(var i=0; i<entryArr.length;i++){
						if(openItem.attr('id') === entryArr[i].attr('id')){
							if(i!==(entryArr.length-1)){
								//console.log($('.headerh2',entryArr[i+1]));
								$('.headerh2',entryArr[i+1]).trigger('click');
								return;
							}else if(i === (entryArr.length-1)){
								popHint('已经是最后一篇');
							}
						}
					}
				}else if(dir === 'up'){
					for(var i=0;i<entryArr.length;i++){
						if(openItem.attr('id') === entryArr[i].attr('id')){
							if( i !== 0){
								$('.headerh2',entryArr[i-1]).trigger('click');
								return;
							}else if(i === 0){
								popHint('已经是第一篇');
							}
						}
					}
				}
			}else{
				if(dir === 'down'){
					$('.headerh2',entryArr[0]).trigger('click');
				}
			}
	};
	
	$('#J_Browse').click(function(e){
		if($(e.target).hasClass('up')){
			entryBrowser('up');
		}else if($(e.target).hasClass('down')){
			entryBrowser('down');
		}
	});
	
	$('#J_Subscribe').click(function(){
		var num = $('#J_DingNum').text()*1;
		if($(this).hasClass('o1')){//这段代码为demo演示，整合还根据原来的方法，完成后调用popHint();
			$(this).removeClass('o1').addClass('o3');
			$('#J_DingNum').text(num+1);
			popHint('订阅源添加成功');
		}else{
			$(this).removeClass('o3').addClass('o1');
			$('#J_DingNum').text(num-1);
			popHint('订阅源取消成功');
		}
	});
	
	
	var testIE6 = function(){
		if(jQuery.browser.msie){
			if(jQuery.browser.version === '6.0') {
				$('#J_CmtTepl_pop').addClass('m-popup-1-p8');
				$('#J_IFIE6').val('yes')
			}
		}
	}

	var init = function(){
		testIE6();
		loadBrief('data/json11.js');
		subsComt();
		
		/* 计算左右滚动区域高度 */
		YD.heightCal('#J_RSec');
		YD.heightCal('#J_LSec');
		
		$(window).resize(function(){
			YD.heightCal('#J_RSec');
			YD.heightCal('#J_LSec');
		});
		
	};
	
	init();
	
});
</script>
</body>
</html>